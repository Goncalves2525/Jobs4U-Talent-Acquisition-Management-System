import java.util.List;

public class VisitorImplementation extends jobRequirementsInputBaseVisitor<Boolean> {
    int points = 0;

    @Override
    public Boolean visitQuestion1(jobRequirementsInputParser.Question1Context ctx) {
        int questionPoints = 0;
        if (ctx.answer1() != null) {
            int yearsOfExperience = Integer.parseInt(ctx.answer1().getText());
            if (yearsOfExperience >= 5) {
                points += 10;
                questionPoints = 10;
            } else if (yearsOfExperience >= 1) {
                points += 5;
                questionPoints = 5;
            }
            System.out.println("Question 1: " + ctx.getText());
            System.out.println("+" + questionPoints + " points for having " + yearsOfExperience + " years of experience in IT.");
        } else {
            System.out.println("Question 1: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion1(ctx);
    }

    @Override
    public Boolean visitQuestion2(jobRequirementsInputParser.Question2Context ctx) {
        int questionPoints = 0;
        if (ctx.answer2() != null) {
            String degree = ctx.answer2().getText();
            if(degree.equals("PhD")) {
                points += 10;
                questionPoints = 10;
            } else if(degree.equals("Master")) {
                points += 5;
                questionPoints = 5;
            }else if(degree.equals("Bachelor")) {
                points += 2;
                questionPoints = 2;
            }
            System.out.println("Question 2: " + ctx.getText());
            System.out.println("+" + questionPoints + " points for having a " + degree + " degree.");
        } else {
            System.out.println("Question 2: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion2(ctx);
    }

    @Override
    public Boolean visitQuestion3(jobRequirementsInputParser.Question3Context ctx) {
        int questionPoints = 0;
        if (ctx.answer3() != null) {
            List<jobRequirementsInputParser.OsContext> osList = ctx.answer3().os();
            System.out.println("Question 3: " + ctx.getText());
            String[] wordsToCheck = {"Windows", "Linux"};
            StringBuilder osStringBuilder = new StringBuilder();
            for (jobRequirementsInputParser.OsContext osContext : osList) {
                String os = osContext.getText();
                boolean found = false;
                for (String word : wordsToCheck) {
                    if (os.trim().equalsIgnoreCase(word.trim())) {
                        points += 5;
                        questionPoints += 5;
                        osStringBuilder.append(os.trim()).append(", ");
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    System.out.println("Unrecognized operating system: " + os.trim());
                }
            }
            String osMessage = osStringBuilder.toString();
            if (!osMessage.isEmpty()) {
                osMessage = osMessage.substring(0, osMessage.lastIndexOf(",")); // Remove the last comma
                osMessage = "+" + questionPoints + " points because you are proficient in " + osMessage;
                System.out.println(osMessage);
            } else {
                System.out.println("+0 points because no recognized operating systems provided.");
            }
        } else {
            System.out.println("Question 3: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion3(ctx);
    }

    @Override
    public Boolean visitQuestion4(jobRequirementsInputParser.Question4Context ctx) {
        int questionPoints = 0;
        if (ctx.answer4() != null) {
            List<jobRequirementsInputParser.LanguageContext> languageList = ctx.answer4().language();
            System.out.println("Question 4: " + ctx.getText());
            String[] languagesToCheck = {"Python", "Java", "C++", "Bash", "PowerShell"};
            StringBuilder languageStringBuilder = new StringBuilder();
            for (jobRequirementsInputParser.LanguageContext languageContext : languageList) {
                String language = languageContext.getText();
                boolean found = false;
                for (String lang : languagesToCheck) {
                    if (language.trim().equalsIgnoreCase(lang.trim())) {
                        points += 2;
                        questionPoints += 2;
                        languageStringBuilder.append(language.trim()).append(", ");
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    System.out.println("Unrecognized language: " + language.trim());
                }
            }
            String languageMessage = languageStringBuilder.toString();
            if (!languageMessage.isEmpty()) {
                languageMessage = languageMessage.substring(0, languageMessage.lastIndexOf(",")); // Remove the last comma
                languageMessage = "+" + questionPoints + " points because you are proficient in " + languageMessage;
                System.out.println(languageMessage);
            } else {
                System.out.println("+0 points because no recognized languages provided.");
            }
        } else {
            System.out.println("Question 4: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion4(ctx);
    }

    @Override
    public Boolean visitQuestion5(jobRequirementsInputParser.Question5Context ctx) {
        int questionPoints = 0;
        if (ctx.answer5() != null) {
            int yearsOfExperience = Integer.parseInt(ctx.answer5().getText());
            if (yearsOfExperience >= 5) {
                points += 10;
                questionPoints = 10;
            } else if (yearsOfExperience >= 1) {
                points += 5;
                questionPoints = 5;
            }
            System.out.println("Question 5: " + ctx.getText());
            System.out.println("+" + questionPoints + " points for having " + yearsOfExperience + " years of experience in penetration testing.");
        } else {
            System.out.println("Question 5: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion5(ctx);
    }

    @Override
    public Boolean visitQuestion6(jobRequirementsInputParser.Question6Context ctx) {
        int questionPoints = 0;
        if (ctx.answer6() != null) {
            List<jobRequirementsInputParser.CertificationContext> certificationList = ctx.answer6().certification();
            System.out.println("Question 6: " + ctx.getText());
            String[] certificationsToCheck = {"OSCP", "CEH", "CISSP", "GPEN", "CISM"};
            StringBuilder certificationStringBuilder = new StringBuilder();
            for (jobRequirementsInputParser.CertificationContext certificationContext : certificationList) {
                String certification = certificationContext.getText();
                boolean found = false;
                for (String cert : certificationsToCheck) {
                    if (certification.trim().equalsIgnoreCase(cert.trim())) {
                        points += 2;
                        questionPoints += 2;
                        certificationStringBuilder.append(certification.trim()).append(", ");
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    System.out.println("Unrecognized certification: " + certification.trim());
                }
            }
            String certificationMessage = certificationStringBuilder.toString();
            if (!certificationMessage.isEmpty()) {
                certificationMessage = certificationMessage.substring(0, certificationMessage.lastIndexOf(",")); // Remove the last comma
                certificationMessage = "+" + questionPoints + " points because you have the following certifications: " + certificationMessage;
                System.out.println(certificationMessage);
            } else {
                System.out.println("+0 points because no recognized certifications provided.");
            }
        } else {
            System.out.println("Question 6: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion6(ctx);
    }

    @Override
    public Boolean visitQuestion7(jobRequirementsInputParser.Question7Context ctx) {
        int questionPoints = 0;
        if (ctx.answer7() != null) {
            List<jobRequirementsInputParser.ToolContext> toolList = ctx.answer7().tool();
            System.out.println("Question 7: " + ctx.getText());
            String[] toolsToCheck = {"Metasploit", "Burp Suite", "Nmap", "Wireshark", "Nessus"};
            StringBuilder toolStringBuilder = new StringBuilder();
            for (jobRequirementsInputParser.ToolContext toolContext : toolList) {
                String tool = toolContext.getText();
                boolean found = false;
                for (String t : toolsToCheck) {
                    if (tool.trim().equalsIgnoreCase(t.trim())) {
                        points += 2;
                        questionPoints += 2;
                        toolStringBuilder.append(tool.trim()).append(", ");
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    System.out.println("Unrecognized tool: " + tool.trim());
                }
            }
            String toolMessage = toolStringBuilder.toString();
            if (!toolMessage.isEmpty()) {
                toolMessage = toolMessage.substring(0, toolMessage.lastIndexOf(",")); // Remove the last comma
                toolMessage = "+" + questionPoints + " points because you are proficient in " + toolMessage;
                System.out.println(toolMessage);
            } else {
                System.out.println("+0 points because no recognized tools provided.");
            }
        } else {
            System.out.println("Question 7: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion7(ctx);
    }

    @Override
    public Boolean visitQuestion8(jobRequirementsInputParser.Question8Context ctx) {
        int questionPoints = 0;
        if (ctx.answer8() != null) {
            String answer = ctx.answer8().getText();
            if (answer.equalsIgnoreCase("Yes")) {
                points += 10;
                questionPoints = 10;
            }
            System.out.println("Question 8: " + ctx.getText());
            System.out.println("+" + questionPoints + " points for being familiar with the OWASP Top Ten vulnerabilities.");
        } else {
            System.out.println("Question 8: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion8(ctx);
    }

    @Override
    public Boolean visitQuestion9(jobRequirementsInputParser.Question9Context ctx) {
        int questionPoints = 0;
        if (ctx.answer9() != null) {
            int rating = Integer.parseInt(ctx.answer9().getText());
            if (rating >= 4) {
                points += 10;
                questionPoints = 10;
            } else if(rating >= 2){
                points += 5;
                questionPoints = 5;
            }
            System.out.println("Question 9: " + ctx.getText());
            System.out.println("+" + questionPoints + " points for rating your analytical and problem-solving skills as " + rating + "/5.");
        } else {
            System.out.println("Question 9: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        return super.visitQuestion9(ctx);
    }

    @Override
    public Boolean visitQuestion10(jobRequirementsInputParser.Question10Context ctx) {
        int questionPoints = 0;
        if (ctx.answer10() != null) {
            String answer = ctx.answer10().getText();
            if (answer.equalsIgnoreCase("Yes")) {
                points += 10;
                questionPoints = 10;
            }
            System.out.println("Question 10: " + ctx.getText());
            System.out.println("+" + questionPoints + " points for being able to start working within the next month.");
        } else {
            System.out.println("Question 10: No answer provided.");
            System.out.printf("+0 points for not answering the question.");
        }
        System.out.println("----------------------------------------------------------------------------------");
        System.out.println();

        if(points >= 50){
            System.out.println(points + "/100");
            System.out.println("APPROVED");
            return true;
        } else {
            System.out.println(points + "/100");
            System.out.println("REJECTED");
            return false;
        }
    }
}
