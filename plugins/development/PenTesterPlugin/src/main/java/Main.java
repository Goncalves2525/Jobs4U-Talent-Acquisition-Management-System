import org.antlr.v4.runtime.CharStreams;
import org.antlr.v4.runtime.CommonTokenStream;
import org.antlr.v4.runtime.tree.ParseTree;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Scanner;

public class Main {
    public static void main(String[] args) throws IOException {
        String filePath = "";
        if(args.length > 0) {
            switch(Integer.parseInt(args[0])){
                case 1:
                    processFile(args[1]);
                    break;
                case 2:
                    //processRuntimeInput();
                    break;
                case 3:
                    generateJobRequirementsFile(args[1]);
                    break;
            }
        }else{
            filePath = "JobRequirementsForPenTester.txt";
            boolean exit = false;
            int choice = -1;
            Scanner scanner = new Scanner(System.in);
            while (!exit) {
                System.out.println("Welcome to the Job Requirements Verification System");
                System.out.println("1. Process file");
                System.out.println("2. Process runtime input");
                System.out.println("3. Generate job requirements file");
                System.out.println("0. Exit");
                System.out.println("Enter your choice: ");
                choice = scanner.nextInt();

                switch (choice) {
                    case 1:
                        processFile(filePath);
                        break;
                    case 2:
                        //processRuntimeInput();
                        break;
                    case 3:
                        generateJobRequirementsFile(filePath);
                        break;
                    case 0:
                        exit = true;
                        break;
                    default:
                        System.out.println("Invalid choice. Please choose again.");
                }
            }
            scanner.close();
        }
    }



    public static void generateJobRequirementsFile(String fileName) {
        String content = "How many years of experience do you have in IT?\n\n"
                + "Select your Degree (None, Bachelor, Master, PhD)\n\n"
                + "Which operating systems are you proficient in? (Windows, Linux) Note: Seperated by \",\"\n\n"
                + "Which programming or scripting languages are you proficient in? (Python, Java, C++, Bash, PowerShell) Note: Seperated by \",\"\n\n"
                + "How many years of experience do you have in penetration testing?\n\n"
                + "Do you have any of the following certifications? (OSCP, CEH, CISSP, GPEN, CISM) Note: Seperated by \",\"\n\n"
                + "Which penetration testing tools are you proficient in? (Metasploit, Burp Suite, Nmap, Wireshark, Nessus) Note: Seperated by \",\"\n\n"
                + "Are you familiar with the OWASP Top Ten vulnerabilities? (Yes or No)\n\n"
                + "How would you rate your analytical and problem-solving skills? (1-5)\n\n"
                + "Can you start working within the next month? (Yes or No)\n\n";

        try {
            FileWriter fileWriter = new FileWriter(fileName);
            fileWriter.write(content);
            fileWriter.close();
            System.out.println("Job requirements file generated successfully.");
        } catch (IOException e) {
            System.out.println("An error occurred while generating the job requirements file.");
            e.printStackTrace();
        }
    }

    private static void processFile(String filePath) {
        try {
            FileInputStream file = new FileInputStream(new File(filePath));
            jobRequirementsInputLexer lexer = new jobRequirementsInputLexer(CharStreams.fromStream(file));
            CommonTokenStream tokens = new CommonTokenStream(lexer);
            jobRequirementsInputParser parser = new jobRequirementsInputParser(tokens);
            ParseTree tree = parser.start();
            VisitorImplementation visitor = new VisitorImplementation();
            boolean passed = visitor.visit(tree);
            try {
                FileWriter fileWriter = new FileWriter(filePath, true);
                if(passed){
                    fileWriter.append("\nAPPROVED");
                }else{
                    fileWriter.append("\nREJECTED");
                }
                fileWriter.close();
                System.out.println("Appended result to file");
            } catch (IOException e) {
                System.out.println("An error occurred while appending result to file");
                e.printStackTrace();
            }

        } catch (Exception e) {
            System.out.println("An error occurred while reading the file.");
            e.printStackTrace();
        }
    }
}